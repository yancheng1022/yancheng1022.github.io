---
abbrlink: 0
---
# 1、两个50亿url的文件如何找出共同的url

**问题:** 给A，B两个文件，各存放50亿条URL，每条URL占用64个字节，内存限制为4G，找出A，B中相同的URL。

**分析:** 1G = 10亿字节，可以估计每个文件的大小为5×64=320G，远远大于内存限制的4G。所以不可能将其完全加载到内存中处理。考虑采取分而治之的方法

**方案:** 分治思想

1. 分治思想遍历文件A，对每个url求hash(url)%N，然后将取得的值分布到N个小文件中，每个小文件可以放在内存中。
2. 遍历文件B，采取和A相同的方式将url存储到N个小文件中.
3. 分布取两个小文件，把一个小文件加入hashset，然后遍历另一个，如果url在哈希表，则为共同url，汇总到结果中。

> 有可能出现哈希碰撞，可以采用多个哈希函数减少碰撞概率。


# 2、如何从1000w记录中，找出最热门的10个记录？

**问题：** 搜索引擎会通过日志文件把用户每次检索使用的所有检索串都记录下来，每个查询串的长度为1-255字节。假设目前一个日志文件中有一千万个记录 (这些查询串的重复度比较高，虽然总数是1千万，但如果除去重复后，不超过了百万个。一个查询串的重复度越高，说明查询它的用户越多，也就是越热门) ，请你统计最热门的1口个查询串，要求使用的内存不能超过1G

**分析：** 1000万条记录，每条记录最大为255Byte，那么日志文件最大有2.5G左右（超过1G）如果去重复有100万条记录，占用250M内存。那么我们可以考虑将这些无重复的记录装入内存。这时我们需要一种数据结构，这种数据结构既能够存储查询串，又能存储查询串的出现次数。

第一步、先对这批海量数据预处理，用hashmap存储，key为内容，value为出现次数 。O（N）
第二步、创建一个长度为10的小根堆，遍历hashmap，如果MinHeap未满，那么往MinHeap中插入这个键值对，如果MinHeap满了，则比较遍历到的元素的count值堆顶的count，如果遍历到元素的count大于堆顶count值，删除堆顶元素，插入当前遍历到的元素。遍历完整个hashmap以后，在MinHeap中存储的就是最热门10个查询串

# 3、20亿个用户统计登录状态

> 20亿的用户，频繁改变数据库，io极大，数据库性能可能会被拖垮。
> 考虑使用redis，如果用set存储，登录存入set，退出删除。一个用户按4字节，10亿个用户4G内存，太大

我们使用redis的bitmap来进行存储。
setbit 语法:setbit key offset value  设置或修改key上的偏移量 (offset) 的位 (value) 的值
10亿用户，1个用户只占用1bit 相比于set占用的4字节，优化了了32倍那么节省后的内存为125MB。
优点:查找效率高。
缺点: 结果数据不能重复，数据如果太过分散会造成浪费，只有数据密集才可以